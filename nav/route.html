
<!DOCTYPE html>
<html lang="nl">
<head>
    <title>JM route</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
        .leafletMap {
            width: 800px;
            height: 800px;
        }
    </style>

</head>
<body>

<div class="leafletMap"></div>

<script src="https://lib.hmcms.nl/js/2/jquery.js"></script>
<script src="https://lib.hmcms.nl/js/2/libloader.js?load=hm.leaflet.map"></script>
<!-- hm.leaflet.custom -->
<script>
(function($, window, undefined) {
    // init widgets
    $(document).ready(function() {
        var $leafletMap = $('.leafletMap'),
            leaflet = new $.hm.leaflet.Map($leafletMap.get(0), {
                center: [51.8786502,5.8486047], // Joris thuis
                zoom: 15
            }),
            // destinationMarker = L.marker([51.685681,5.3557583]).addTo(leaflet.map),
            // lineBetweenDestinationAndLocation,
            currentLocationMarker,
            myCurrentRoutePath;


        // overlay custom image
        L.imageOverlay('jm.png',
            [[51.87883, 5.84992], [51.87746, 5.85231]]).addTo(leaflet.map);


        // rode lijn
        L.polyline([
            [51.87872050466521,5.850686674576875],[51.878690700201524,5.8517944269000255],[51.8779770429759,5.851496701699372]
        ], {color: 'red'}).addTo(leaflet.map);


        // init map
        leaflet.map
            .locate({
                setView: true,
                // maxZoom: 16,
                watch: true,
                enableHighAccuracy: true
            })
            .on('locationfound', function(e){
                var radius = e.accuracy;

console.log('locationfound', e);

                if (!currentLocationMarker) {
                    currentLocationMarker = L.marker(e.latlng).addTo(leaflet.map);
                } else {
                    if (!myCurrentRoutePath) {
                        myCurrentRoutePath = L.polyline([currentLocationMarker.getLatLng()], {color: 'blue'}).addTo(leaflet.map);
                    } else {
                        myCurrentRoutePath.addLatLng(currentLocationMarker.getLatLng());
                    }

                    currentLocationMarker.setLatLng(e.latlng);
                }

               /* if (!lineBetweenDestinationAndLocation) {
                    lineBetweenDestinationAndLocation = L.polyline([currentLocationMarker.getLatLng(), destinationMarker.getLatLng()], {color: 'red'}).addTo(leaflet.map);
                } else {
                    lineBetweenDestinationAndLocation.setLatLngs([currentLocationMarker.getLatLng(), destinationMarker.getLatLng()]);
                }*/

                // L.marker(e.latlng).addTo(leaflet.map)
                //     .bindPopup("You are within " + radius + " meters from this point").openPopup();

                // L.circle(e.latlng, radius).addTo(leaflet.map);
            })
            .on('locationerror', function(e){
                alert(e.message);
            });

    });
}(jQuery, window));

/*<script>
(function($, window, undefined) {
    // init widgets
    $(document).ready(function() {
        var $leafletMap = $('.leafletMap'),
            leaflet = new $.hm.leaflet.Map($leafletMap.get(0), {
                center: [51.8786502,5.8486047], // Joris thuis
                zoom: 16
            });

        // overlay custom image
        L.imageOverlay('jm.png',
            [[51.878925, 5.849849], [51.877481, 5.852303]]).addTo(leaflet.map);

        // rode lijn
        L.polyline([
            [51.87872050466521,5.850686674576875],[51.878690700201524,5.8517944269000255],[51.8779770429759,5.851496701699372]
        ], {color: 'red'}).addTo(leaflet.map);

        // current position:
        leaflet.map
            .locate({
                setView: true,
                maxZoom: 18,
                watch: true
            })

.on('locationfound', function(e){
                var radius = e.accuracy;

console.log('locationfound', e);

                if (!currentLocationMarker) {
                    currentLocationMarker = L.marker(e.latlng).addTo(leaflet.map);
                } else {
                    if (!myCurrentRoutePath) {
                        myCurrentRoutePath = L.polyline([currentLocationMarker.getLatLng()], {color: 'blue'}).addTo(leaflet.map);
                    } else {
                        myCurrentRoutePath.addLatLng(currentLocationMarker.getLatLng());
                    }

                    currentLocationMarker.setLatLng(e.latlng);
                }

    });
 .on('locationerror', function(e){
                alert(e.message);
            });
}
    (jQuery, window))});*/
</script>

</body>
</html>